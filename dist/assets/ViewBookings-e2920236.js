import{r as l,j as e,D,C as y,S as L,I as A,a as E,b as V,d as $,e as F,f as c,o as I,p as z,q as m,L as P,s as R,u as q,v as X,B as h,w as N,X as H,c as p,t as u}from"./index-7e1fbbdd.js";const G=()=>{const[v,w]=l.useState([]),[C,S]=l.useState([]),[b,j]=l.useState(!0),[n,T]=l.useState(""),[i,_]=l.useState("all"),[d,B]=l.useState("all"),f=async()=>{j(!0);const{data:s,error:t}=await p.from("bookings").select("*").order("created_at",{ascending:!1}),{data:r,error:a}=await p.from("doctor_bookings").select("*").order("created_at",{ascending:!1});(t||a)&&(console.error("Error fetching bookings:",t||a),u({title:"Error",description:"Failed to load bookings",variant:"destructive"})),w(s||[]),S(r||[]),j(!1)};l.useEffect(()=>{f()},[]);const o=async(s,t,r)=>{const{error:a}=await p.from(s).update({status:r}).eq("id",t);a?u({title:"Error",description:a.message,variant:"destructive"}):(u({title:"Updated",description:`Booking marked as ${r}`}),f())},x=[...v.map(s=>({...s,type:"Test",title:Array.isArray(s.test_names)?s.test_names.join(", "):s.test_names,table:"bookings"})),...C.map(s=>({...s,type:"Consultation",title:`Dr. ${s.doctor_id}`,table:"doctor_bookings"}))].sort((s,t)=>new Date(t.created_at)-new Date(s.created_at)),g=(s=>s.filter(t=>{const r=(t.patient_name||"").toLowerCase().includes(n.toLowerCase())||(t.reference_number||"").toLowerCase().includes(n.toLowerCase()),a=i==="all"||(t.status||"pending").toLowerCase()===i.toLowerCase();return r&&a}))(d==="all"?x:d==="tests"?x.filter(s=>s.type==="Test"):x.filter(s=>s.type==="Consultation"));return e.jsx(D,{title:"View Bookings",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative w-full md:w-72",children:[e.jsx(L,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(A,{placeholder:"Search patient name or Ref ID...",className:"pl-9",value:n,onChange:s=>T(s.target.value)})]}),e.jsxs(E,{value:i,onValueChange:_,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx($,{placeholder:"Filter Status"})}),e.jsxs(F,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"confirmed",children:"Confirmed"}),e.jsx(c,{value:"completed",children:"Completed"}),e.jsx(c,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsx(I,{value:d,onValueChange:B,className:"w-full md:w-auto",children:e.jsxs(z,{children:[e.jsx(m,{value:"all",children:"All"}),e.jsx(m,{value:"tests",children:"Lab Tests"}),e.jsx(m,{value:"consultations",children:"Doctor Consults"})]})})]})}),e.jsx(y,{className:"overflow-hidden border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700 font-medium border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Ref ID / Type"}),e.jsx("th",{className:"px-6 py-4",children:"Patient"}),e.jsx("th",{className:"px-6 py-4",children:"Service Details"}),e.jsx("th",{className:"px-6 py-4",children:"Schedule"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center",children:e.jsx(P,{className:"w-6 h-6 animate-spin mx-auto text-[#1FAA59]"})})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No bookings found."})}):g.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-mono text-xs text-gray-500",children:s.reference_number}),e.jsxs("div",{className:`inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded mt-1 ${s.type==="Test"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"}`,children:[s.type==="Test"?e.jsx(R,{className:"w-3 h-3"}):e.jsx(q,{className:"w-3 h-3"}),s.type]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.patient_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.phone})]}),e.jsxs("td",{className:"px-6 py-4 max-w-xs",children:[e.jsx("div",{className:"truncate text-gray-700 font-medium",title:s.title,children:s.title||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500",children:s.type==="Test"?"Home Collection":"Video Consult"})]}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"})," ",s.booking_date]}),e.jsx("div",{className:"text-xs pl-4",children:s.booking_time})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold uppercase tracking-wide ${(s.status||"pending")==="completed"?"bg-green-100 text-green-700":(s.status||"pending")==="confirmed"?"bg-blue-100 text-blue-700":(s.status||"pending")==="cancelled"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:s.status||"Pending"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>o(s.table,s.id,"confirmed"),title:"Confirm",disabled:s.status==="confirmed",children:e.jsx(N,{className:"w-4 h-4 text-blue-600"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>o(s.table,s.id,"completed"),title:"Complete",disabled:s.status==="completed",children:e.jsx(N,{className:"w-4 h-4 text-green-600"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>o(s.table,s.id,"cancelled"),title:"Cancel",disabled:s.status==="cancelled",children:e.jsx(H,{className:"w-4 h-4 text-red-600"})})]})})]},`${s.table}-${s.id}`))})]})})})]})})};export{G as default};
