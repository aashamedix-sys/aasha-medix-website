import{j as e,D as H,E as U,r as a,c as h,t as n,S as G,I as u,a as g,b as j,d as y,e as f,f as c,B as i,R as K,P as $,C as J,L as D,T as Q,h as W,i as X,k as Y,l as Z,m as ee,n as se}from"./index-4e8604e8.js";import{P as te}from"./pen-square-52e44937.js";const ae=()=>{const[E,_]=a.useState([]),[F,v]=a.useState(!0),[N,I]=a.useState(""),[p,k]=a.useState("all"),[L,d]=a.useState(!1),[P,o]=a.useState(!1),[m,b]=a.useState(null),[w,C]=a.useState(!1),[t,l]=a.useState({id:"",test_name:"",category:"",mrp:"",description:"",status:"Active"}),S=["Blood","Diabetes","Cardiac","Hormones","Liver","Kidney","Vitamins","Thyroid","Allergy","Infection","Bone","Nerve","General"];a.useEffect(()=>{x()},[]);const x=async()=>{v(!0);try{const{data:s,error:r}=await h.from("tests").select("*").order("id",{ascending:!0});if(r)throw r;_(s||[])}catch(s){console.error("Error fetching tests:",s),n({title:"Error",description:"Failed to load tests",variant:"destructive"})}finally{v(!1)}},T=E.filter(s=>{if(!s)return!1;const r=String(N||"").toLowerCase(),q=String(s.test_name||"").toLowerCase(),R=String(s.id||"").toLowerCase(),M=q.includes(r)||R.includes(r),z=p==="all"||s.category===p;return M&&z}),B=async()=>{if(!t.id||!t.test_name||!t.mrp||!t.category){n({title:"Validation Error",description:"ID, Name, MRP and Category are required",variant:"destructive"});return}C(!0);try{if(m){const{error:s}=await h.from("tests").update({test_name:t.test_name,category:t.category,mrp:t.mrp,description:t.description,status:t.status}).eq("id",m.id);if(s)throw s;n({title:"Updated",description:"Test updated successfully"})}else{const{error:s}=await h.from("tests").insert([{id:t.id,test_name:t.test_name,category:t.category,mrp:t.mrp,description:t.description,status:t.status,created_at:new Date}]);if(s)throw s;n({title:"Created",description:"Test created successfully"})}await x(),d(!1),o(!1),A()}catch(s){console.error("Error saving test:",s),n({title:"Error",description:s.message||"Failed to save test",variant:"destructive"})}finally{C(!1)}},O=async s=>{if(window.confirm("Are you sure you want to delete this test?"))try{const{error:r}=await h.from("tests").delete().eq("id",s);if(r)throw r;n({title:"Deleted",description:"Test deleted successfully"}),x()}catch{n({title:"Error",description:"Failed to delete test. It might be linked to existing bookings.",variant:"destructive"})}},V=s=>{b(s),l({id:s.id,test_name:s.test_name||s.name||"",category:s.category||"",mrp:s.mrp||"",description:s.description||"",status:s.status||"Active"}),o(!0)},A=()=>{l({id:"",test_name:"",category:"",mrp:"",description:"",status:"Active"}),b(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(G,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(u,{placeholder:"Search test name/code...",className:"pl-9",value:N,onChange:s=>I(s.target.value)})]}),e.jsxs(g,{value:p,onValueChange:k,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(y,{placeholder:"Category"})}),e.jsxs(f,{children:[e.jsx(c,{value:"all",children:"All Categories"}),S.map(s=>e.jsx(c,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",onClick:x,children:[e.jsx(K,{className:"w-4 h-4 mr-2"})," Refresh"]}),e.jsxs(i,{onClick:()=>{A(),d(!0)},className:"bg-[#1FAA59] hover:bg-green-700",children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Add Test"]})]})]}),e.jsx(J,{className:"overflow-hidden border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700 font-medium border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Code"}),e.jsx("th",{className:"px-6 py-4",children:"Test Name"}),e.jsx("th",{className:"px-6 py-4",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Price (₹)"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center",children:e.jsx(D,{className:"w-6 h-6 animate-spin mx-auto text-[#1FAA59]"})})}):T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:"No tests found."})}):T.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-mono font-bold text-gray-700",children:s.id}),e.jsxs("td",{className:"px-6 py-4 font-medium text-gray-900",children:[s.test_name||s.name,s.description&&e.jsx("p",{className:"text-xs text-gray-400 truncate max-w-[200px]",children:s.description})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs border border-blue-100",children:s.category})}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-gray-900",children:s.mrp}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full inline-block mr-2 ${s.status==="Active"?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-600",children:s.status})]}),e.jsxs("td",{className:"px-6 py-4 flex justify-center gap-2",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:bg-blue-50",onClick:()=>V(s),children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:bg-red-50",onClick:()=>O(s.id),children:e.jsx(Q,{className:"w-4 h-4"})})]})]},s.id))})]})})}),e.jsx(W,{open:L||P,onOpenChange:s=>!s&&(d(!1),o(!1)),children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(Y,{children:e.jsx(Z,{children:m?"Edit Test":"Add New Test"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Code (Unique)"}),e.jsx(u,{value:t.id,onChange:s=>l({...t,id:s.target.value}),placeholder:"e.g. T001",disabled:!!m,className:"font-mono uppercase"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Price (₹)"}),e.jsx(u,{type:"number",value:t.mrp,onChange:s=>l({...t,mrp:s.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Name"}),e.jsx(u,{value:t.test_name,onChange:s=>l({...t,test_name:s.target.value}),placeholder:"Full test name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(g,{value:t.category,onValueChange:s=>l({...t,category:s}),children:[e.jsx(j,{children:e.jsx(y,{placeholder:"Select Category"})}),e.jsx(f,{children:S.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(g,{value:t.status,onValueChange:s=>l({...t,status:s}),children:[e.jsx(j,{children:e.jsx(y,{placeholder:"Select Status"})}),e.jsxs(f,{children:[e.jsx(c,{value:"Active",children:"Active"}),e.jsx(c,{value:"Inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description (Optional)"}),e.jsx(ee,{value:t.description||"",onChange:s=>l({...t,description:s.target.value}),placeholder:"Brief details about the test...",rows:3})]})]}),e.jsxs(se,{children:[e.jsx(i,{variant:"outline",onClick:()=>{d(!1),o(!1)},children:"Cancel"}),e.jsx(i,{onClick:B,className:"bg-[#1FAA59] hover:bg-green-700",disabled:w,children:w?e.jsx(D,{className:"w-4 h-4 animate-spin mr-2"}):"Save Test"})]})]})})]})},ne=()=>e.jsx(H,{title:"Manage Tests",children:e.jsx(U,{children:e.jsx(ae,{})})});export{ne as default};
