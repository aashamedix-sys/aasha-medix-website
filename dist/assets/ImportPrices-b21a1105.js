import{c as f,r as h,j as e,H as j,L as N,a as w,C as y,A as b,b as u}from"./index-e5e53e2e.js";const v=f("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);function g(m){const r=m.trim().split(/\r?\n/);if(!r.length)return[];const p=r[0].split(",").map(l=>l.trim()),x=[];for(let l=1;l<r.length;l++){const c=r[l],o=[];let i="",d=!1;for(let t of c){if(t==='"'){d=!d;continue}t===","&&!d?(o.push(i),i=""):i+=t}o.push(i);const a={};p.forEach((t,n)=>{a[t]=(o[n]??"").trim()}),x.push(a)}return x}function k(){const[m,r]=h.useState(null),[p,x]=h.useState(null),[l,c]=h.useState({loading:!1,message:"",error:""}),o=async a=>{const t=a.map(s=>({code:s.code||null,name:s.name||null,category:s.category||null,mrp:s.mrp?Number(s.mrp):null,sample_type:s.sample_type||null,tat:s.tat||null,is_active:String(s.is_active).toLowerCase()==="true",description:s.description||null})).filter(s=>s.name),{error:n}=await u.from("tests").upsert(t,{onConflict:"code"});if(n)throw n;return t.length},i=async a=>{const t=a.map(s=>({code:s.code||null,name:s.name||null,mrp:s.mrp?Number(s.mrp):null,tests_included:s.tests_included||null,description:s.description||null,is_active:String(s.is_active).toLowerCase()==="true"})).filter(s=>s.name),{error:n}=await u.from("health_packages").upsert(t,{onConflict:"code"});if(n)throw n;return t.length},d=async()=>{try{c({loading:!0,message:"",error:""});let a=0,t=0;if(m){const n=await m.text(),s=g(n);a=await o(s)}if(p){const n=await p.text(),s=g(n);t=await i(s)}c({loading:!1,message:`Imported ${a} tests and ${t} packages successfully.`,error:""})}catch(a){console.error("Import failed:",a),c({loading:!1,message:"",error:a.message||"Import failed"})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50",children:[e.jsx(j,{children:e.jsx("title",{children:"Admin: Import Price List - AASHA MEDIX"})}),e.jsx("div",{className:"bg-gradient-to-r from-[#0FA958] to-[#0d8847] text-white py-14",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(N,{to:"/",className:"text-white/80 hover:text-white transition-colors",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-white/60",children:"/"}),e.jsx("span",{children:"Admin"}),e.jsx("span",{className:"text-white/60",children:"/"}),e.jsx("span",{children:"Import Price List"})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold",children:"Import Price List"}),e.jsx("p",{className:"text-green-100 max-w-3xl",children:"Upload CSVs generated from your official PDF to update tests and health packages."})]})}),e.jsx("div",{className:"container mx-auto px-4 py-10",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft p-6 border border-gray-100",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Tests CSV"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Expected headers: ",e.jsx("span",{className:"font-mono",children:"code,name,category,mrp,sample_type,tat,is_active,description"})]}),e.jsx("input",{type:"file",accept:".csv",onChange:a=>{var t;return r(((t=a.target.files)==null?void 0:t[0])||null)},className:"block w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Health Packages CSV"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Expected headers: ",e.jsx("span",{className:"font-mono",children:"code,name,mrp,tests_included,description,is_active"})]}),e.jsx("input",{type:"file",accept:".csv",onChange:a=>{var t;return x(((t=a.target.files)==null?void 0:t[0])||null)},className:"block w-full border rounded-lg p-2"})]})]}),e.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[e.jsxs("button",{onClick:d,disabled:l.loading,className:"inline-flex items-center gap-2 bg-[#0FA958] text-white px-5 py-3 rounded-full shadow-md hover:shadow-lg",children:[e.jsx(v,{className:"w-5 h-5"}),l.loading?"Importingâ€¦":"Import Now"]}),l.message&&e.jsxs("span",{className:"inline-flex items-center gap-2 text-emerald-700",children:[e.jsx(y,{className:"w-5 h-5"})," ",l.message]}),l.error&&e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(b,{className:"w-5 h-5"})," ",l.error]})]}),e.jsx("div",{className:"mt-8 text-sm text-gray-600",children:e.jsxs("p",{children:["Tip: Use the templates in ",e.jsx("span",{className:"font-mono",children:"data/tests_import_template.csv"})," and ",e.jsx("span",{className:"font-mono",children:"data/packages_import_template.csv"}),". Export data from your PDF into these CSVs and upload here."]})})]})})]})}export{k as default};
