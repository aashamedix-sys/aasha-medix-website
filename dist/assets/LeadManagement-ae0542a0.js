import{z as L,j as e,D as F,E as V,r as n,B as x,C as f,J as w,S as z,I as R,a as h,b as m,d as u,e as j,f as t,aB as T,x as A,v as B,c as S,t as C}from"./index-7e1fbbdd.js";const H=L("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),P=L("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),_=()=>{const[k,g]=n.useState([]),[D,p]=n.useState(!0),[v,y]=n.useState(""),[i,b]=n.useState("all"),[o,N]=n.useState("all"),M=async()=>{p(!0);let s=S.from("leads").select("*").order("created_at",{ascending:!1});i!=="all"&&(s=s.eq("status",i)),o!=="all"&&(s=s.ilike("service",`%${o}%`));const{data:l,error:c}=await s;c?C({variant:"destructive",title:"Error",description:"Failed to fetch leads."}):g(l||[]),p(!1)};n.useEffect(()=>{M()},[i,o]);const d=k.filter(s=>{if(!s)return!1;const l=String(s.name||"").toLowerCase(),c=String(s.mobile||""),a=String(v||"").toLowerCase();return l.includes(a)||c.includes(a)}),I=async(s,l)=>{const{error:c}=await S.from("leads").update({status:l}).eq("id",s);c||(C({title:"Updated",description:"Lead status updated."}),g(a=>a.map(r=>r.id===s?{...r,status:l}:r)))},E=()=>{const l=[["Name","Mobile","Service","Status","Notes","Date"].join(","),...d.map(r=>[r.name,r.mobile,r.service,r.status,`"${r.notes||""}"`,new Date(r.created_at).toLocaleDateString()].join(","))].join(`
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(a.download!==void 0){const r=URL.createObjectURL(c);a.setAttribute("href",r),a.setAttribute("download","aasha_leads_export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leads CRM"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Manage and track patient inquiries."})]}),e.jsxs(x,{variant:"outline",onClick:E,className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," Export CSV"]})]}),e.jsx(f,{className:"bg-gray-50 border-gray-200",children:e.jsxs(w,{className:"p-4 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(R,{placeholder:"Search name or mobile...",className:"pl-9 bg-white",value:v,onChange:s=>y(s.target.value)})]}),e.jsxs(h,{value:i,onValueChange:b,children:[e.jsx(m,{className:"bg-white",children:e.jsx(u,{placeholder:"Status"})}),e.jsxs(j,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"New",children:"New"}),e.jsx(t,{value:"In Progress",children:"In Progress"}),e.jsx(t,{value:"Converted",children:"Converted"}),e.jsx(t,{value:"Lost",children:"Lost"})]})]}),e.jsxs(h,{value:o,onValueChange:N,children:[e.jsx(m,{className:"bg-white",children:e.jsx(u,{placeholder:"Service Interest"})}),e.jsxs(j,{children:[e.jsx(t,{value:"all",children:"All Services"}),e.jsx(t,{value:"Diagnostics",children:"Diagnostics"}),e.jsx(t,{value:"Home Collection",children:"Home Collection"}),e.jsx(t,{value:"Telemedicine",children:"Telemedicine"})]})]}),e.jsxs(x,{variant:"secondary",onClick:()=>{y(""),b("all"),N("all")},children:[e.jsx(T,{className:"w-4 h-4 mr-2"})," Reset"]})]})}),e.jsx(f,{className:"overflow-hidden",children:e.jsx(w,{className:"p-0 overflow-x-auto",children:D?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading leads data..."}):d.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No leads found matching criteria."}):e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Name / Contact"}),e.jsx("th",{className:"px-6 py-4",children:"Service"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d.map(s=>e.jsxs("tr",{className:"bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center mt-1",children:[e.jsx(A,{className:"w-3 h-3 mr-1"})," ",s.mobile]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded-md text-xs font-medium border border-blue-100",children:s.service})}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),new Date(s.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(h,{defaultValue:s.status,onValueChange:l=>I(s.id,l),children:[e.jsx(m,{className:`h-8 w-[130px] border-0 text-xs font-semibold rounded-full ${s.status==="New"?"bg-blue-100 text-blue-700 hover:bg-blue-200":s.status==="Converted"?"bg-green-100 text-green-700 hover:bg-green-200":s.status==="Lost"?"bg-red-100 text-red-700 hover:bg-red-200":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"}`,children:e.jsx(u,{})}),e.jsxs(j,{children:[e.jsx(t,{value:"New",children:"New"}),e.jsx(t,{value:"In Progress",children:"In Progress"}),e.jsx(t,{value:"Converted",children:"Converted"}),e.jsx(t,{value:"Lost",children:"Lost"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(x,{size:"icon",variant:"ghost",className:"h-8 w-8 text-gray-400 hover:text-gray-600",children:e.jsx(P,{className:"w-4 h-4"})})})]},s.id))})]})})})]})},U=()=>e.jsx(F,{title:"Leads CRM",children:e.jsx(V,{children:e.jsx(_,{})})});export{U as default};
